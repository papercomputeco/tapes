---
interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="description" content="Transparent telemetry infrastructure for AI agents—capturing what agents do with cryptographic verification and zero latency through a reverse proxy architecture using Merkle DAG storage." />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="canonical" href="https://tapes.dev/" />
    <title>{title}</title>

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://tapes.dev/" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content="Transparent telemetry infrastructure for AI agents—capturing what agents do with cryptographic verification and zero latency through a reverse proxy architecture using Merkle DAG storage." />
    <meta property="og:image" content="https://tapes.dev/tapes-social.png" />
    <meta property="og:site_name" content="Tapes" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://tapes.dev/" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content="Transparent telemetry infrastructure for AI agents—capturing what agents do with cryptographic verification and zero latency through a reverse proxy architecture using Merkle DAG storage." />
    <meta name="twitter:image" content="https://tapes.dev/tapes-social.png" />

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Tapes",
      "description": "Transparent telemetry infrastructure for AI agents—capturing what agents do with cryptographic verification and zero latency through a reverse proxy architecture using Merkle DAG storage.",
      "url": "https://tapes.dev/",
      "applicationCategory": "DeveloperApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>
    <script is:inline>
      // Set theme immediately to prevent flash
      const theme = localStorage.getItem('theme') ||
        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
    </script>
  </head>
  <body>
    <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true">Copied to clipboard</div>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <nav id="nav-menu" class="nav-menu" aria-label="Main navigation">
      <div class="nav-menu-header">
        <button
          id="nav-toggle"
          class="nav-toggle"
          aria-label="Open navigation menu"
          aria-expanded="false"
          aria-controls="nav-menu-content"
        >
          <div class="hamburger" aria-hidden="true">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </div>
        </button>
      </div>
      <div id="nav-menu-content" class="nav-menu-content" aria-hidden="true">
        <div class="nav-section" role="group" aria-labelledby="nav-section-tapes">
          <h2 id="nav-section-tapes" class="nav-section-title">tapes</h2>
          <ul class="nav-links">
            <li><a href="#install">Install</a></li>
            <li><a href="#run">Run</a></li>
            <li><a href="#use">Use</a></li>
            <li><a href="#architecture">Architecture</a></li>
          </ul>
        </div>
        <div class="nav-section" role="group" aria-labelledby="nav-section-tapesapi">
          <h2 id="nav-section-tapesapi" class="nav-section-title">tapesapi</h2>
          <ul class="nav-links">
            <li><a href="#inspect">Inspect</a></li>
          </ul>
        </div>
        <div class="nav-footer">
          <img src="/quarter-tapes.png" alt="Tapes" class="nav-logo" />
        </div>
      </div>
    </nav>
    <button id="theme-toggle" aria-label="Switch to dark theme">
      <svg class="sun-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <circle cx="12" cy="12" r="5"/>
        <line x1="12" y1="1" x2="12" y2="3"/>
        <line x1="12" y1="21" x2="12" y2="23"/>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
        <line x1="1" y1="12" x2="3" y2="12"/>
        <line x1="21" y1="12" x2="23" y2="12"/>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
      </svg>
      <svg class="moon-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
      </svg>
    </button>
    <slot />
    <script is:inline>
      // Listen for system preference changes
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (!localStorage.getItem('theme')) {
          document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
        }
      });

      // Toggle button with dynamic aria-label
      const themeToggle = document.getElementById('theme-toggle');
      function updateThemeToggleLabel() {
        const current = document.documentElement.getAttribute('data-theme');
        themeToggle?.setAttribute('aria-label', current === 'dark' ? 'Switch to light theme' : 'Switch to dark theme');
      }
      updateThemeToggleLabel();

      themeToggle?.addEventListener('click', () => {
        const current = document.documentElement.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
        updateThemeToggleLabel();
      });

      // Navigation menu with full keyboard support
      document.addEventListener('DOMContentLoaded', () => {
        const navToggle = document.getElementById('nav-toggle');
        const navMenu = document.getElementById('nav-menu');
        const navMenuContent = document.getElementById('nav-menu-content');
        const navLinks = document.querySelectorAll('.nav-links a');
        const focusableElements = navMenuContent?.querySelectorAll(
          'a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])'
        );
        const firstFocusable = focusableElements?.[0];
        const lastFocusable = focusableElements?.[focusableElements.length - 1];

        function openNav() {
          navMenu?.classList.add('open');
          navToggle?.setAttribute('aria-expanded', 'true');
          navToggle?.setAttribute('aria-label', 'Close navigation menu');
          navMenuContent?.setAttribute('aria-hidden', 'false');
          document.body.style.overflow = 'hidden';
          // Move focus to first link after animation
          setTimeout(() => {
            firstFocusable?.focus();
          }, 100);
        }

        function closeNav(returnFocus = true) {
          navMenu?.classList.remove('open');
          navToggle?.setAttribute('aria-expanded', 'false');
          navToggle?.setAttribute('aria-label', 'Open navigation menu');
          navMenuContent?.setAttribute('aria-hidden', 'true');
          document.body.style.overflow = '';
          if (returnFocus) {
            navToggle?.focus();
          }
        }

        function toggleNav() {
          const isOpen = navMenu?.classList.contains('open');
          if (isOpen) {
            closeNav();
          } else {
            openNav();
          }
        }

        // Focus trap - keep focus within menu when open
        function handleFocusTrap(e) {
          if (!navMenu?.classList.contains('open')) return;

          if (e.key === 'Tab') {
            if (e.shiftKey) {
              // Shift + Tab
              if (document.activeElement === firstFocusable) {
                e.preventDefault();
                lastFocusable?.focus();
              }
            } else {
              // Tab
              if (document.activeElement === lastFocusable) {
                e.preventDefault();
                firstFocusable?.focus();
              }
            }
          }
        }

        // Escape key closes menu
        function handleEscapeKey(e) {
          if (e.key === 'Escape' && navMenu?.classList.contains('open')) {
            closeNav();
          }
        }

        navToggle?.addEventListener('click', toggleNav);

        // Keyboard event listeners
        document.addEventListener('keydown', handleEscapeKey);
        document.addEventListener('keydown', handleFocusTrap);

        navLinks.forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = link.getAttribute('href');
            if (targetId) {
              const target = document.querySelector(targetId);
              if (target) {
                closeNav(false);
                setTimeout(() => {
                  target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                  // Set focus to target section for screen readers
                  target.setAttribute('tabindex', '-1');
                  target.focus();
                }, 150);
              }
            }
          });
        });
      });

      // Add copy buttons to all code blocks
      document.querySelectorAll('pre').forEach((pre) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'code-block';
        pre.parentNode?.insertBefore(wrapper, pre);
        wrapper.appendChild(pre);

        const button = document.createElement('button');
        button.className = 'copy-button';
        button.setAttribute('aria-label', 'Copy code');
        button.innerHTML = `
          <svg class="copy-icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
          </svg>
          <svg class="check-icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
        `;
        wrapper.appendChild(button);

        button.addEventListener('click', async () => {
          const code = pre.querySelector('code')?.textContent || pre.textContent || '';
          await navigator.clipboard.writeText(code);
          button.classList.add('copied');
          setTimeout(() => button.classList.remove('copied'), 2000);

          const toast = document.getElementById('toast');
          if (toast) {
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
          }
        });
      });
    </script>
  </body>
</html>

<style is:global>
  :root {
    --bg: #ffffff;
    --bg-secondary: #f5f5f5;
    --text: #171717;
    --text-secondary: #525252;
    --accent: #ea580c;
    --border: #e5e5e5;
    --code-bg: #1e1e1e;
    --code-text: #d4d4d4;
    --code-border: #3c3c3c;
  }

  [data-theme="dark"] {
    --bg: #0a0a0a;
    --bg-secondary: #141414;
    --text: #fafafa;
    --text-secondary: #a3a3a3;
    --accent: #ff8c42;
    --border: #262626;
    --code-bg: #18181b;
    --code-text: #e4e4e7;
    --code-border: #27272a;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    scroll-behavior: smooth;
  }

  body {
    min-height: 100vh;
  }

  a {
    color: var(--accent);
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  code {
    font-family: "SF Mono", "Fira Code", "Fira Mono", Menlo, Monaco, Consolas, monospace;
    font-size: 0.875em;
    background: var(--code-bg);
    color: var(--code-text);
    padding: 0.2em 0.4em;
    border-radius: 6px;
  }

  pre {
    background: var(--code-bg);
    color: var(--code-text);
    padding: 1.25rem 1.5rem;
    border-radius: 12px;
    overflow-x: auto;
    border: 1px solid var(--code-border);
  }

  pre code {
    background: none;
    padding: 0;
    font-size: 0.875rem;
    line-height: 1.8;
    letter-spacing: 0.01em;
  }

  ::selection {
    background: var(--accent);
    color: white;
  }

  #theme-toggle {
    position: fixed;
    top: 1rem;
    right: 1rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s ease;
  }

  #theme-toggle:hover {
    color: var(--text);
    border-color: var(--text-secondary);
  }

  #theme-toggle .sun-icon {
    display: none;
  }

  #theme-toggle .moon-icon {
    display: block;
  }

  [data-theme="dark"] #theme-toggle .sun-icon {
    display: block;
  }

  [data-theme="dark"] #theme-toggle .moon-icon {
    display: none;
  }

  .code-block {
    position: relative;
    margin-bottom: 1.5rem;
  }

  .copy-button {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: var(--code-border);
    border: none;
    border-radius: 6px;
    padding: 0.4rem;
    cursor: pointer;
    color: var(--code-text);
    opacity: 0;
    transition: opacity 0.15s ease, background 0.15s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .code-block:hover .copy-button {
    opacity: 1;
  }

  .copy-button:hover {
    background: var(--text-secondary);
  }

  .copy-button .check-icon {
    display: none;
  }

  .copy-button.copied .copy-icon {
    display: none;
  }

  .copy-button.copied .check-icon {
    display: block;
    color: #22c55e;
  }

  .toast {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    transform: translateY(100px);
    background: var(--text);
    color: var(--bg);
    padding: 0.75rem 1.25rem;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 500;
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
    z-index: 1000;
    pointer-events: none;
  }

  .toast.show {
    transform: translateY(0);
    opacity: 1;
  }

  /* Navigation Menu - shadcn style */
  .nav-menu {
    position: fixed;
    top: 0;
    left: 0;
    z-index: 100;
    pointer-events: none;
  }

  .nav-menu-header {
    pointer-events: auto;
    display: inline-block;
    padding: 0.875rem 1.5rem;
  }

  .nav-menu.open {
    width: 100%;
    height: 100vh;
    pointer-events: auto;
    background: rgba(9, 9, 11, 0.8);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  [data-theme="light"] .nav-menu.open {
    background: rgba(255, 255, 255, 0.8);
  }

  .nav-menu.open .nav-menu-header {
    display: block;
  }

  .nav-toggle {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s ease;
  }

  .nav-toggle:hover {
    color: var(--text);
    border-color: var(--text-secondary);
  }

  .hamburger {
    position: relative;
    width: 1rem;
    height: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .hamburger-line {
    position: absolute;
    left: 0;
    display: block;
    width: 1rem;
    height: 2px;
    background: var(--text-secondary);
    transition: all 0.15s ease;
  }

  .nav-toggle:hover .hamburger-line {
    background: var(--text);
  }

  .hamburger-line:first-child {
    top: 4px;
  }

  .hamburger-line:last-child {
    top: 10px;
  }

  .nav-menu.open .hamburger-line:first-child {
    top: 7px;
    transform: rotate(-45deg);
  }

  .nav-menu.open .hamburger-line:last-child {
    top: 7px;
    transform: rotate(45deg);
  }

  .nav-menu-content {
    position: absolute;
    top: 3rem;
    left: 0;
    width: 100%;
    height: calc(100vh - 3rem);
    padding: 1.5rem;
    overflow-y: auto;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s ease;
  }

  .nav-menu.open .nav-menu-content {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .nav-section {
    margin-bottom: 1.5rem;
  }

  .nav-section-title {
    display: block;
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
  }

  .nav-links {
    list-style: none;
    padding: 0;
  }

  .nav-links li {
    margin: 0;
  }

  .nav-links a {
    display: block;
    padding: 0.375rem 0;
    color: var(--text);
    font-size: 1.25rem;
    font-weight: 600;
    transition: color 0.15s ease;
  }

  .nav-links a:hover {
    color: var(--text-secondary);
    text-decoration: none;
  }

  .nav-footer {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border);
  }

  .nav-logo {
    width: 200px;
    height: auto;
  }

  @media (max-width: 600px) {
    .nav-logo {
      width: 120px;
    }
  }

  /* Skip link for keyboard navigation */
  .skip-link {
    position: absolute;
    top: -100%;
    left: 1rem;
    z-index: 200;
    padding: 0.75rem 1rem;
    background: var(--accent);
    color: white;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    transition: top 0.2s ease;
  }

  .skip-link:focus {
    top: 1rem;
  }

  /* Focus indicators for keyboard navigation */
  *:focus {
    outline: none;
  }

  *:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }

  .nav-toggle:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }

  #theme-toggle:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }

  .nav-links a:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 4px;
    border-radius: 4px;
  }

  .copy-button:focus-visible {
    opacity: 1;
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }

  /* Ensure h2 section titles look like the original spans */
  .nav-section-title {
    font-size: 0.8125rem;
    font-weight: normal;
    margin: 0;
  }
</style>
