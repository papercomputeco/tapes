---
interface Props {
  title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="description" content="Transparent telemetry infrastructure for AI agents—capturing what agents do with cryptographic verification and zero latency through a reverse proxy architecture using Merkle DAG storage." />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="canonical" href="https://tapes.dev/" />
    <title>{title}</title>

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://tapes.dev/" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content="Transparent telemetry infrastructure for AI agents—capturing what agents do with cryptographic verification and zero latency through a reverse proxy architecture using Merkle DAG storage." />
    <meta property="og:image" content="https://tapes.dev/tapes-social.png" />
    <meta property="og:site_name" content="Tapes" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://tapes.dev/" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content="Transparent telemetry infrastructure for AI agents—capturing what agents do with cryptographic verification and zero latency through a reverse proxy architecture using Merkle DAG storage." />
    <meta name="twitter:image" content="https://tapes.dev/tapes-social.png" />

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Tapes",
      "description": "Transparent telemetry infrastructure for AI agents—capturing what agents do with cryptographic verification and zero latency through a reverse proxy architecture using Merkle DAG storage.",
      "url": "https://tapes.dev/",
      "applicationCategory": "DeveloperApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>
    <script is:inline>
      // Set theme immediately to prevent flash
      const theme = localStorage.getItem('theme') ||
        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
    </script>
  </head>
  <body>
    <div id="toast" class="toast">Copied to clipboard</div>
    <div id="nav-overlay" class="nav-overlay"></div>
    <nav id="nav-drawer" class="nav-drawer">
      <div class="nav-header">
        <span>Navigation</span>
        <button id="nav-close" aria-label="Close navigation">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <ul class="nav-links">
        <li><a href="#install">Install</a></li>
        <li><a href="#run">Run</a></li>
        <li><a href="#use">Use</a></li>
        <li><a href="#inspect">Inspect</a></li>
        <li><a href="#architecture">Architecture</a></li>
      </ul>
    </nav>
    <button id="nav-toggle" class="nav-toggle" aria-label="Open navigation">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"/>
        <line x1="3" y1="12" x2="21" y2="12"/>
        <line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
    </button>
    <button id="theme-toggle" aria-label="Toggle theme">
      <svg class="sun-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="5"/>
        <line x1="12" y1="1" x2="12" y2="3"/>
        <line x1="12" y1="21" x2="12" y2="23"/>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
        <line x1="1" y1="12" x2="3" y2="12"/>
        <line x1="21" y1="12" x2="23" y2="12"/>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
      </svg>
      <svg class="moon-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
      </svg>
    </button>
    <slot />
    <script is:inline>
      // Listen for system preference changes
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (!localStorage.getItem('theme')) {
          document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
        }
      });

      // Toggle button
      document.getElementById('theme-toggle')?.addEventListener('click', () => {
        const current = document.documentElement.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
      });

      // Navigation drawer
      document.addEventListener('DOMContentLoaded', () => {
        const navToggle = document.getElementById('nav-toggle');
        const navClose = document.getElementById('nav-close');
        const navDrawer = document.getElementById('nav-drawer');
        const navOverlay = document.getElementById('nav-overlay');
        const navLinks = document.querySelectorAll('.nav-links a');

        function openNav() {
          navDrawer?.classList.add('open');
          navOverlay?.classList.add('open');
          document.body.style.overflow = 'hidden';
        }

        function closeNav() {
          navDrawer?.classList.remove('open');
          navOverlay?.classList.remove('open');
          document.body.style.overflow = '';
        }

        navToggle?.addEventListener('click', openNav);
        navClose?.addEventListener('click', closeNav);
        navOverlay?.addEventListener('click', closeNav);

        navLinks.forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = link.getAttribute('href');
            if (targetId) {
              const target = document.querySelector(targetId);
              if (target) {
                closeNav();
                setTimeout(() => {
                  target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 150);
              }
            }
          });
        });
      });

      // Add copy buttons to all code blocks
      document.querySelectorAll('pre').forEach((pre) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'code-block';
        pre.parentNode?.insertBefore(wrapper, pre);
        wrapper.appendChild(pre);

        const button = document.createElement('button');
        button.className = 'copy-button';
        button.setAttribute('aria-label', 'Copy code');
        button.innerHTML = `
          <svg class="copy-icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
          </svg>
          <svg class="check-icon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
        `;
        wrapper.appendChild(button);

        button.addEventListener('click', async () => {
          const code = pre.querySelector('code')?.textContent || pre.textContent || '';
          await navigator.clipboard.writeText(code);
          button.classList.add('copied');
          setTimeout(() => button.classList.remove('copied'), 2000);

          const toast = document.getElementById('toast');
          if (toast) {
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
          }
        });
      });
    </script>
  </body>
</html>

<style is:global>
  :root {
    --bg: #ffffff;
    --bg-secondary: #f5f5f5;
    --text: #171717;
    --text-secondary: #525252;
    --accent: #ea580c;
    --border: #e5e5e5;
    --code-bg: #1e1e1e;
    --code-text: #d4d4d4;
    --code-border: #3c3c3c;
  }

  [data-theme="dark"] {
    --bg: #0a0a0a;
    --bg-secondary: #141414;
    --text: #fafafa;
    --text-secondary: #a3a3a3;
    --accent: #ff8c42;
    --border: #262626;
    --code-bg: #18181b;
    --code-text: #e4e4e7;
    --code-border: #27272a;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    scroll-behavior: smooth;
  }

  body {
    min-height: 100vh;
  }

  a {
    color: var(--accent);
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  code {
    font-family: "SF Mono", "Fira Code", "Fira Mono", Menlo, Monaco, Consolas, monospace;
    font-size: 0.875em;
    background: var(--code-bg);
    color: var(--code-text);
    padding: 0.2em 0.4em;
    border-radius: 6px;
  }

  pre {
    background: var(--code-bg);
    color: var(--code-text);
    padding: 1.25rem 1.5rem;
    border-radius: 12px;
    overflow-x: auto;
    border: 1px solid var(--code-border);
  }

  pre code {
    background: none;
    padding: 0;
    font-size: 0.875rem;
    line-height: 1.8;
    letter-spacing: 0.01em;
  }

  ::selection {
    background: var(--accent);
    color: white;
  }

  #theme-toggle {
    position: fixed;
    top: 1rem;
    right: 1rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s ease;
  }

  #theme-toggle:hover {
    color: var(--text);
    border-color: var(--text-secondary);
  }

  #theme-toggle .sun-icon {
    display: none;
  }

  #theme-toggle .moon-icon {
    display: block;
  }

  [data-theme="dark"] #theme-toggle .sun-icon {
    display: block;
  }

  [data-theme="dark"] #theme-toggle .moon-icon {
    display: none;
  }

  .code-block {
    position: relative;
    margin-bottom: 1.5rem;
  }

  .copy-button {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: var(--code-border);
    border: none;
    border-radius: 6px;
    padding: 0.4rem;
    cursor: pointer;
    color: var(--code-text);
    opacity: 0;
    transition: opacity 0.15s ease, background 0.15s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .code-block:hover .copy-button {
    opacity: 1;
  }

  .copy-button:hover {
    background: var(--text-secondary);
  }

  .copy-button .check-icon {
    display: none;
  }

  .copy-button.copied .copy-icon {
    display: none;
  }

  .copy-button.copied .check-icon {
    display: block;
    color: #22c55e;
  }

  .toast {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    transform: translateY(100px);
    background: var(--text);
    color: var(--bg);
    padding: 0.75rem 1.25rem;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 500;
    opacity: 0;
    transition: transform 0.3s ease, opacity 0.3s ease;
    z-index: 1000;
    pointer-events: none;
  }

  .toast.show {
    transform: translateY(0);
    opacity: 1;
  }

  /* Navigation Toggle */
  .nav-toggle {
    position: fixed;
    top: 1rem;
    left: 1rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s ease;
    z-index: 100;
  }

  .nav-toggle:hover {
    color: var(--text);
    border-color: var(--text-secondary);
  }

  /* Navigation Overlay */
  .nav-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s ease, visibility 0.2s ease;
    z-index: 200;
  }

  .nav-overlay.open {
    opacity: 1;
    visibility: visible;
  }

  /* Navigation Drawer */
  .nav-drawer {
    position: fixed;
    top: 0;
    left: 0;
    width: 280px;
    height: 100%;
    background: var(--bg);
    border-right: 1px solid var(--border);
    transform: translateX(-100%);
    transition: transform 0.2s ease;
    z-index: 300;
    display: flex;
    flex-direction: column;
  }

  .nav-drawer.open {
    transform: translateX(0);
  }

  .nav-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border);
  }

  .nav-header span {
    font-weight: 600;
    font-size: 1rem;
  }

  .nav-header button {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.15s ease;
  }

  .nav-header button:hover {
    color: var(--text);
  }

  .nav-links {
    list-style: none;
    padding: 1rem 0;
    flex: 1;
    overflow-y: auto;
  }

  .nav-links li {
    margin: 0;
  }

  .nav-links a {
    display: block;
    padding: 0.75rem 1.25rem;
    color: var(--text-secondary);
    font-size: 0.95rem;
    transition: all 0.15s ease;
  }

  .nav-links a:hover {
    color: var(--text);
    background: var(--bg-secondary);
    text-decoration: none;
  }
</style>
